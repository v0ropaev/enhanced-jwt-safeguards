# Enhanced JWT Safeguards API

**–ü—Ä–æ–µ–∫—Ç –¥–ª—è –∫—É—Ä—Å–æ–≤–æ–π —Ä–∞–±–æ—Ç—ã** ‚Äî –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –Ω–∞ FastAPI —Å JWT, —Ä–µ–π—Ç–ª–∏–º–∏—Ç–∏–Ω–≥–æ–º, –æ—Ç–∑—ã–≤–æ–º –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ç–æ–∫–µ–Ω–æ–≤.

## üîê –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é **JWT** (access + refresh —Ç–æ–∫–µ–Ω—ã)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ **–∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–¥–ø–∏—Å–∏** —Ç–æ–∫–µ–Ω–∞
- –ó–∞—â–∏—Ç–∞ —Å –ø–æ–º–æ—â—å—é **—Ä–µ–π—Ç-–ª–∏–º–∏—Ç–æ–≤** (SlowAPI)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ **–æ—Ç–∑—ã–≤–∞ refresh-—Ç–æ–∫–µ–Ω–æ–≤** (blacklist)
- –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è refresh-—Ç–æ–∫–µ–Ω–∞
- Swagger UI –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `/docs`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üöÄ –ó–∞–ø—É—Å–∫

1. –ö–ª–æ–Ω–∏—Ä—É–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
git clone https://github.com/v0ropaev/enhanced-jwt-safeguards.git
cd enhanced-jwt-safeguards
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
```

3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è RSA –∫–ª—é—á–µ–π:

```bash
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -pubout -out public.pem
```

4. –°–æ–∑–¥–∞–π `.env`:

```env
PRIVATE_KEY_PATH=private.pem
PUBLIC_KEY_PATH=public.pem
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_MINUTES=60
```

5. –ó–∞–ø—É—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

```bash
uvicorn app.main:app --reload
```

6. –ü–µ—Ä–µ–π–¥–∏ –≤ Swagger UI:

```
http://127.0.0.1:8000/docs
```

---

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º

| Method | URL            | –û–ø–∏—Å–∞–Ω–∏–µ                             |
|--------|----------------|--------------------------------------|
| POST   | `/register`    | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è      |
| POST   | `/login`       | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è, –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤    |
| POST   | `/refresh`     | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ access –∏ refresh —Ç–æ–∫–µ–Ω–∞   |
| POST   | `/logout`      | –û—Ç–∑—ã–≤ refresh-—Ç–æ–∫–µ–Ω–∞                 |
| GET    | `/protected`   | –ó–∞—â–∏—â–µ–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç (access —Ç–æ–∫–µ–Ω)    |

---

## üß™ –¢–µ—Å—Ç—ã

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤:

```bash
PYTHONPATH=./ pytest
```

–¢–µ—Å—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ [`tests/`](./tests/), –ø–æ–∫—Ä—ã–≤–∞—é—Ç:
- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
- –≤—Ö–æ–¥
- –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- –∑–∞—â–∏—Ç—É `/protected`

---

## üõ° –ü–ª–∞–Ω –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ –∏ `alg`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `scope` –≤ refresh-—Ç–æ–∫–µ–Ω–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–æ–∑–≤–∞–Ω–Ω—ã—Ö —Ç–æ–∫–µ–Ω–æ–≤ (`revoked`)
- ‚úÖ –ë–ª–æ–∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è refresh (`used`)
- ‚úÖ –õ–∏–º–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ API

---

## üìé –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- FastAPI
- jose (JWT)
- passlib (bcrypt)
- slowapi (—Ä–µ–π—Ç–ª–∏–º–∏—Ç–∏–Ω–≥)
- dotenv
- uvicorn
